{% extends "base.html" %}

{% block title %}Schedule Pickup - ReStitch{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative bg-gradient-to-br from-primary-600 to-secondary-600 text-white py-16">
    <div class="absolute inset-0 opacity-10">
        <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80" 
             alt="Pickup" class="w-full h-full object-cover">
    </div>
    <div class="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">Schedule Your Pickup</h1>
        <p class="text-xl text-gray-100">Let us collect your unused clothes and give them a new purpose</p>
    </div>
</section>

<!-- Pickup Form -->
<section class="py-20 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12">
            
            <!-- Progress Steps -->
            <div class="mb-12">
                <div class="flex items-center justify-center space-x-8">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center text-white font-semibold">1</div>
                        <span class="ml-3 text-primary-600 font-medium">Service Details</span>
                    </div>
                    <div class="w-16 h-1 bg-gray-200"></div>
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 font-semibold">2</div>
                        <span class="ml-3 text-gray-500 font-medium">Schedule</span>
                    </div>
                    <div class="w-16 h-1 bg-gray-200"></div>
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 font-semibold">3</div>
                        <span class="ml-3 text-gray-500 font-medium">Confirmation</span>
                    </div>
                </div>
            </div>

            <form method="POST" enctype="multipart/form-data" class="space-y-8">
                {{ form.hidden_tag() }}
                {{ form.csrf_token }}
                
                <!-- Service Type Selection -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">What would you like to do?</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {% for value, label, description in [('donate', 'Donate', 'Give your clothes to those in need'), ('redesign', 'Redesign', 'Transform into new fashion pieces'), ('resale', 'Resale', 'Sell through our platform')] %}
                        <label class="relative cursor-pointer">
                            <input type="radio" name="service_type" value="{{ value }}" class="sr-only peer service-type-radio" required onchange="toggleServiceFields('{{ value }}')">
                            <div class="bg-white border-2 border-gray-200 rounded-xl p-6 text-center peer-checked:border-primary-600 peer-checked:bg-primary-50 transition-all duration-200 hover:border-primary-300">
                                <div class="w-16 h-16 {% if value == 'donate' %}bg-green-100{% elif value == 'redesign' %}bg-purple-100{% else %}bg-blue-100{% endif %} rounded-full flex items-center justify-center mx-auto mb-4">
                                    <svg class="w-8 h-8 {% if value == 'donate' %}text-green-600{% elif value == 'redesign' %}text-purple-600{% else %}text-blue-600{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        {% if value == 'donate' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                        {% elif value == 'redesign' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                                        {% else %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                                        {% endif %}
                                    </svg>
                                </div>
                                <h3 class="font-semibold text-gray-900 mb-2">{{ label }}</h3>
                                <p class="text-sm text-gray-600">{{ description }}</p>
                            </div>
                        </label>
                        {% endfor %}
                    </div>
                    
                    <!-- Designer Selection (for Redesign) -->
                    <div id="designer-selection" class="hidden space-y-4">
                        <h3 class="text-lg font-semibold text-gray-900">Select Designer</h3>
                        <select name="designer_id" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <option value="">Choose a designer</option>
                            {% for designer in designers %}
                            <option value="{{ designer.id }}">{{ designer.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Sale Price (for Resale) -->
                    <div id="sale-price" class="hidden space-y-4">
                        <h3 class="text-lg font-semibold text-gray-900">Expected Sale Price</h3>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-gray-500">â‚¹</span>
                            <input type="number" name="sale_price" placeholder="Enter expected price" class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                    </div>
                </div>

                <!-- Address Selection -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-900">Pickup Address</h2>
                    
                    {% if addresses %}
                        <div class="space-y-3">
                            {% for address in addresses %}
                            <label class="flex items-start p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-300 transition-colors duration-200">
                                <input type="radio" name="address" value="{{ address.id }}" class="mt-1 mr-4" required>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-900">{{ address.line1 }}</div>
                                    {% if address.line2 %}<div class="text-gray-600">{{ address.line2 }}</div>{% endif %}
                                    <div class="text-gray-600">{{ address.city }}, {{ address.state }} {{ address.zip_code }}</div>
                                </div>
                            </label>
                            {% endfor %}
                        </div>
                        
                        <button type="button" class="text-primary-600 hover:text-primary-700 font-medium" onclick="showAddAddressForm()">
                            + Add New Address
                        </button>
                    {% else %}
                        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                            <p class="text-yellow-800">You need to add an address first. Please add your pickup address below.</p>
                        </div>
                    {% endif %}
                    
                    <!-- Add Address Form (Hidden by default) -->
                    <div id="add-address-form" class="hidden bg-gray-50 rounded-xl p-6 space-y-4">
                        <h3 class="font-semibold text-gray-900">Add New Address</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" placeholder="Address Line 1" class="px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <input type="text" placeholder="Address Line 2 (Optional)" class="px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <input type="text" placeholder="City" class="px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <input type="text" placeholder="State" class="px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <input type="text" placeholder="PIN Code" class="px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                        <div class="flex space-x-4">
                            <button type="button" class="btn-primary">Save Address</button>
                            <button type="button" class="btn-secondary" onclick="hideAddAddressForm()">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Date & Time Selection -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-900">Preferred Pickup Time</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pickup Date</label>
                            <input type="date" name="preferred_slot" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Time Slot</label>
                            <select name="time_slot" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500">
                                <option value="9:00">9:00 AM - 12:00 PM</option>
                                <option value="12:00">12:00 PM - 3:00 PM</option>
                                <option value="15:00">3:00 PM - 6:00 PM</option>
                                <option value="18:00">6:00 PM - 9:00 PM</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Item Details -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-900">Item Details</h2>
                    
                    <div>
                        {{ form.items.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        {{ form.items(class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none") }}
                        <p class="mt-2 text-sm text-gray-500">List each item on a new line (e.g., Blue cotton shirt, Black jeans, Winter jacket)</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Photos <span id="photo-required" class="text-red-500 hidden">(Required for Resale)</span></label>
                        <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-primary-400 transition-colors duration-200">
                            {{ form.photos(class="hidden", id="photo-upload") }}
                            <label for="photo-upload" class="cursor-pointer">
                                <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="text-gray-600">Click to upload photos or drag and drop</p>
                                <p class="text-sm text-gray-500 mt-2">PNG, JPG up to 10MB</p>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Additional Notes -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-900">Additional Notes</h2>
                    
                    <div>
                        {{ form.notes(class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none", placeholder="Any special instructions for pickup (e.g., gate code, preferred entrance, etc.)") }}
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-8 border-t border-gray-200">
                    <button type="submit" class="btn-primary w-full text-lg">
                        <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 4v10m6-10v10m-6 0h6"></path>
                        </svg>
                        Schedule Pickup
                    </button>
                    
                    <p class="text-center text-sm text-gray-500 mt-4">
                        By scheduling a pickup, you agree to our 
                        <a href="#" class="text-primary-600 hover:text-primary-700">Terms of Service</a> and 
                        <a href="#" class="text-primary-600 hover:text-primary-700">Privacy Policy</a>
                    </p>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Benefits Section -->
<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Why Choose ReStitch Pickup?</h2>
            <p class="text-xl text-gray-600">Convenient, sustainable, and rewarding</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Free Pickup</h3>
                <p class="text-gray-600">No charges for doorstep collection. We come to you at your convenience.</p>
            </div>
            
            <div class="text-center">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Quality Assured</h3>
                <p class="text-gray-600">Professional handling and processing of all donated items with care.</p>
            </div>
            
            <div class="text-center">
                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Earn Rewards</h3>
                <p class="text-gray-600">Get ReStitch points for every donation that you can redeem for discounts.</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function showAddAddressForm() {
    document.getElementById('add-address-form').classList.remove('hidden');
}

function hideAddAddressForm() {
    document.getElementById('add-address-form').classList.add('hidden');
}

function toggleServiceFields(serviceType) {
    const designerSelection = document.getElementById('designer-selection');
    const salePrice = document.getElementById('sale-price');
    const photoRequired = document.getElementById('photo-required');
    const photoUpload = document.getElementById('photo-upload');
    
    // Hide all service-specific fields
    designerSelection.classList.add('hidden');
    salePrice.classList.add('hidden');
    photoRequired.classList.add('hidden');
    
    // Show relevant fields based on service type
    if (serviceType === 'redesign') {
        designerSelection.classList.remove('hidden');
        designerSelection.querySelector('select').required = true;
        salePrice.querySelector('input').required = false;
        photoUpload.required = false;
    } else if (serviceType === 'resale') {
        salePrice.classList.remove('hidden');
        photoRequired.classList.remove('hidden');
        salePrice.querySelector('input').required = true;
        photoUpload.required = true;
        designerSelection.querySelector('select').required = false;
    } else {
        designerSelection.querySelector('select').required = false;
        salePrice.querySelector('input').required = false;
        photoUpload.required = false;
    }
}

// File upload preview
document.getElementById('photo-upload').addEventListener('change', function(e) {
    const files = e.target.files;
    if (files.length > 0) {
        const label = e.target.parentElement;
        label.innerHTML = `
            <svg class="w-8 h-8 text-green-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 font-medium">${files.length} file(s) selected</p>
        `;
    }
});
</script>
{% endblock %}